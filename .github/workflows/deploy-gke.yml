name: CI/CD to GKE (keyless)

on:
  push:
    branches: [ "main" ]        # after PRs are merged
  workflow_dispatch:

permissions:
  contents: read
  id-token: write               # required for OIDC â†’ WIF

concurrency:
  group: deploy-gke-prod
  cancel-in-progress: true

env:
  PROJECT_ID:     ${{ vars.GCP_PROJECT }}
  GAR_LOCATION:   ${{ vars.GAR_LOCATION }}        # e.g. europe-north2
  GAR_REPO:       ${{ vars.GAR_REPO }}            # e.g. recipes-repo
  IMAGE_NAME:     ${{ vars.IMAGE_NAME }}          # e.g. receptsamling
  IMAGE_URI:      ${{ vars.GAR_LOCATION }}-docker.pkg.dev/${{ vars.GCP_PROJECT }}/${{ vars.GAR_REPO }}/${{ vars.IMAGE_NAME }}
  GKE_CLUSTER:    ${{ vars.GKE_CLUSTER }}         # e.g. receptsamling
  GKE_LOCATION:   ${{ vars.GKE_LOCATION }}        # e.g. europe-nort
